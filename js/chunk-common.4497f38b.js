(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[0],{"13ac":function(t,e,n){},"27cf":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("q-dialog",{model:{value:t.shouldShow,callback:function(e){t.shouldShow=e},expression:"shouldShow"}},[n("q-card",{staticClass:"q-pa-lg",staticStyle:{width:"440px"}},[n("q-card-section",{staticClass:"row items-center q-pb-none"},[n("div",{staticClass:"text-h6"},[t._v(t._s(t.title))]),n("q-space"),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),n("q-card-section",{staticClass:"q-pt-none"},[t._v(t._s(t.content))]),t.showInfo?t._e():n("q-card-actions",{staticClass:"bg-white text-teal",attrs:{align:"center"}},[n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"btn-sumit q-mr-lg",attrs:{outline:"",color:"primary",label:"取消"},on:{click:t.cancel}}),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"btn-sumit",attrs:{unelevated:"",color:"primary",label:"确定"},on:{click:t.comfirm}})],1),t.showInfo?n("q-card-actions",{staticClass:"bg-white text-teal",attrs:{align:"center"}},[n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-px-xl",attrs:{unelevated:"",color:"primary",label:"查看详情"},on:{click:t.comfirm}})],1):t._e()],1)],1)],1)},a=[],o={components:{},props:{title:{type:String,default:"弹框默认标题"},content:{type:String,default:"弹框默认备注"},showInfo:{type:Boolean,default:!1},value:Boolean},data:function(){return{show:!1,small:""}},watch:{},computed:{shouldShow:{get:function(){return this.value},set:function(t){this.$emit("input",t)}}},methods:{comfirm:function(){this.$emit("taost_confirm")},cancel:function(){this.$emit("taost_cancel")}},created:function(){},mounted:function(){}},s=o,r=(n("7720"),n("2877")),c=n("eebe"),l=n.n(c),u=n("24e8"),d=n("f09f"),p=n("a370"),h=n("2c91"),f=n("9c40"),m=n("4b7e"),v=n("7f67"),g=Object(r["a"])(s,i,a,!1,null,"5df879f2",null);e["a"]=g.exports;l()(g,"components",{QDialog:u["a"],QCard:d["a"],QCardSection:p["a"],QSpace:h["a"],QBtn:f["a"],QCardActions:m["a"]}),l()(g,"directives",{ClosePopup:v["a"]})},"304d":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ToastComponent",{attrs:{title:t.title,content:t.content},on:{taost_cancel:t.taost_cancel,taost_confirm:t.taost_confirm},model:{value:t.shouldShow,callback:function(e){t.shouldShow=e},expression:"shouldShow"}})},a=[],o=n("967e"),s=n.n(o),r=(n("96cf"),n("fa84")),c=n.n(r),l=(n("c5f6"),n("27cf")),u={components:{ToastComponent:l["a"]},props:{value:Boolean,groupId:Number},data:function(){return{title:"真的要退出小组？",content:""}},watch:{},computed:{shouldShow:{get:function(){return this.value},set:function(t){this.$emit("input",t)}}},methods:{taost_cancel:function(){this.$q.notify("已取消")},taost_confirm:function(){var t=this;return c()(s.a.mark((function e(){var n,i,a;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n="/protected/grp/detach",i={grp:t.groupId},e.next=4,t.$axios.post(n,i);case 4:a=e.sent,0===a.data.code?(t.$q.notify({message:"已退出本群。"}),t.$router.go(0)):104===a.data.code&&(t.$q.notify({message:"认证失效，请重新登录"}),t.$showLogin());case 6:case"end":return e.stop()}}),e)})))()}},created:function(){},mounted:function(){}},d=u,p=n("2877"),h=Object(p["a"])(d,i,a,!1,null,null,null);e["a"]=h.exports},"3b4c":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"header-bar-right"},[t.isLoggedIn?n("div",[n("q-avatar",{staticClass:"header-notify",attrs:{size:"36px",icon:"notifications_none"}},[t.unreadNotify.length?n("q-badge",{attrs:{color:"red",floating:""}},[t._v(t._s(t.unreadNotify.length))]):t._e(),n("q-menu",{attrs:{"transition-show":"jump-down","transition-hide":"jump-up"},on:{hide:t.hideNotice}},[0===t.notificationsShow.length?n("div",[t._v("近期无通知。")]):t._e(),n("q-list",{staticStyle:{"min-width":"310px"}},t._l(t.notificationsShow,(function(e){return n("div",{key:e.id},[n("q-item",{staticClass:"header-notify-detail",class:{unread:1==e.read}},[1!==e.n_type&&e.n_type?t._e():n("q-item-section",[n("q-item-label",{attrs:{lines:"2"}},[t._v(t._s(e.h_text))])],1),2===e.n_type||3===e.n_type?n("q-item-section",{attrs:{side:"",avatar:""}},[n("q-avatar",{attrs:{size:"35px"}},[n("img",{attrs:{src:e.creatorIn.avatar||"statics/user.svg"}})])],1):t._e(),2===e.n_type?n("q-item-section",[n("q-item-label",{attrs:{lines:"2"}},[n("router-link",{attrs:{to:{name:"articles",params:{id:e.post+""}}}},[t._v("\n                    "+t._s(e.h_text)+"\n                    "),n("br"),n("div",{staticClass:"content"},[t._v(t._s(e.postIn.content.substr(0,30)))])])],1)],1):t._e(),3===e.n_type?n("q-item-section",[n("q-item-label",{attrs:{lines:"2"}},[n("router-link",{attrs:{to:{name:"articles",params:{id:e.commentIn.post+""}}}},[t._v("\n                    "+t._s(e.h_text)+"\n                    "),n("br"),n("div",{staticClass:"content"},[t._v("“"+t._s(e.commentIn.content.substr(0,30))+"”")]),n("br")])],1)],1):t._e()],1),n("q-separator")],1)})),0)],1)],1),n("q-avatar",{staticClass:"header-avatar hoverable-avatar",attrs:{size:"30px"}},[n("img",{attrs:{src:t.$store.state.user.avatar||"statics/user.svg"}}),n("q-menu",{attrs:{"transition-show":"jump-down","transition-hide":"jump-up"}},[n("q-list",{staticStyle:{"min-width":"100px"}},[n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""}},[n("q-item-section",{on:{click:t.createGrp}},[t._v("新建一个群")])],1),t.isInGroupPath&&t.groupJoined?n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""}},[n("q-item-section",{on:{click:function(e){return t.setGroupToTop()}}},[t._v(t._s(2===t.isPinned?"取消置顶本群":"置顶本群"))])],1):t._e(),t.isInGroupPath&&t.groupJoined?n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""}},[n("q-item-section",{on:{click:function(e){return t.leaveGroup()}}},[t._v("退出本群")])],1):t._e(),n("q-separator"),n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""}},[n("q-item-section",{on:{click:function(e){return t.$router.push("/person/show/"+t.$store.state.user.userid)}}},[t._v("我的DAO @"+t._s(t.user.userid))])],1),n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""}},[n("q-item-section",{on:{click:t.clearLogin}},[t._v("退出登录 ("+t._s(t.user.name)+")")])],1)],1)],1)],1),n("q-dialog",{attrs:{"content-class":"notify-dialog","transition-show":"fade","transition-hide":"fade",seamless:"",position:"top"},on:{hide:t.hideNotice},model:{value:t.showNotice,callback:function(e){t.showNotice=e},expression:"showNotice"}},[n("q-card",[n("q-card-section",{staticStyle:{"max-width":"310px"}},[0===t.notificationsShow.length?n("div",[t._v("近期无通知。")]):t._e(),n("q-list",t._l(t.notificationsShow,(function(e){return n("div",{key:e.id},[n("q-item",{staticClass:"header-notify-detail",class:{unread:1==e.read}},[n("q-item-section",[n("q-item-label",{attrs:{lines:"2"}},[t._v(t._s(e.h_text))])],1),n("q-item-section",{attrs:{side:""}},[n("q-item-label",{attrs:{caption:""}},[t._v(t._s(t.$utils.timeStringToLocal(e.create_at,"RelativeTime")))])],1)],1),n("q-separator")],1)})),0)],1)],1)],1)],1):n("q-btn",{directives:[{name:"require-login-click",rawName:"v-require-login-click"}],attrs:{color:"primary",flat:"",label:"快速登录"}}),n("groupCreate",{model:{value:t.showCreate,callback:function(e){t.showCreate=e},expression:"showCreate"}}),n("quitGroup",{attrs:{groupId:t.quitGroupId},model:{value:t.showQuitGroup,callback:function(e){t.showQuitGroup=e},expression:"showQuitGroup"}})],1)},a=[],o=n("4db1"),s=n.n(o),r=n("967e"),c=n.n(r),l=(n("96cf"),n("fa84")),u=n.n(l),d=(n("7514"),n("f8c8")),p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-dialog",{model:{value:t.shouldShow,callback:function(e){t.shouldShow=e},expression:"shouldShow"}},[n("q-card",{staticClass:"q-pa-lg",staticStyle:{width:"700px","max-width":"80vw"},attrs:{"full-width":""}},[n("q-card-section",{staticClass:"row items-center q-pb-none"},[n("div",{staticClass:"text-h6"},[t._v("创建一个群")]),n("q-space"),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),n("q-card-section",{staticClass:"row items-top"},[n("div",{staticClass:"col q-pa-md"},[n("q-form",{staticClass:"q-gutter-xs"},[n("q-input",{attrs:{label:"群名称","lazy-rules":"",rules:[function(t){return t&&t.length>0||"群名不能为空"}]},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),n("q-input",{attrs:{maxlength:"300",placeholder:"描述下你的话题，引起大家的兴趣",type:"textarea",counter:"",rows:"4"},on:{keyup:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.stopPropagation()}},model:{value:t.desc_text,callback:function(e){t.desc_text=e},expression:"desc_text"}}),n("q-radio",{attrs:{checked:"",val:"1",label:"任何人"},model:{value:t.read_permission,callback:function(e){t.read_permission=e},expression:"read_permission"}}),n("q-radio",{attrs:{val:"2",label:"仅限组员"},model:{value:t.read_permission,callback:function(e){t.read_permission=e},expression:"read_permission"}}),2==t.read_permission?n("div",[n("q-input",{attrs:{label:"设定密码",type:"password",placeholder:""},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1):t._e()],1)],1),n("div",{staticClass:"col-5 q-pa-md"},[t._v("\n        创建群之后你还可以设置以下参数：入群奖励、阅读奖励、回复奖励等。\n        "),n("br"),n("br"),t._v("请注意，所有的这些奖励的代币将不经过你的确认直接从你的钱包扣掉。\n        若你的钱包余额不够支付奖励，则该群的所有奖励设置将自动归零。\n        "),n("br"),n("br"),t._v("创建群代表你为群内所有言论负责。你若退群，则系统将自动接替你做群主。\n      ")])]),n("q-card-actions",{staticClass:"bg-white text-teal",attrs:{align:"center"}},[n("q-btn",{staticClass:"q-px-xl",attrs:{unelevated:"",color:"primary",label:"完成"},on:{click:t.createGroup}})],1)],1)],1)},h=[],f=(n("7f7f"),n("c5f6"),{components:{},props:{value:Boolean},data:function(){return{title:"",desc_text:"",read_permission:"1",password:""}},watch:{},computed:{shouldShow:{get:function(){return this.value},set:function(t){this.$emit("input",t)}}},methods:{createGroup:function(){var t=this;return u()(c.a.mark((function e(){var n,i,a;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n={name:t.title,desc_text:t.desc_text,read_permission:Number(t.read_permission),password:t.password,avatar:""},""!=n.name&&""!=n.desc_text&&""!=n.read_permission){e.next=5;break}t.$q.notify("信息不完整，请完善信息"),e.next=11;break;case 5:return i="/protected/grp/create",e.next=8,t.$axios.post(i,n);case 8:a=e.sent,0==a.data.code?(t.shouldShow=!1,t.$router.go(0)):t.$q.notify(a.data.message),t.shouldShow=!1;case 11:case"end":return e.stop()}}),e)})))()}},created:function(){},mounted:function(){}}),m=f,v=n("2877"),g=n("eebe"),b=n.n(g),w=n("24e8"),y=n("f09f"),_=n("a370"),k=n("2c91"),q=n("9c40"),x=n("0378"),C=n("27f9"),$=n("3786"),S=n("4b7e"),P=n("7f67"),I=Object(v["a"])(m,p,h,!1,null,null,null),O=I.exports;b()(I,"components",{QDialog:w["a"],QCard:y["a"],QCardSection:_["a"],QSpace:k["a"],QBtn:q["a"],QForm:x["a"],QInput:C["a"],QRadio:$["a"],QCardActions:S["a"]}),b()(I,"directives",{ClosePopup:P["a"]});var L=n("304d"),j={name:"headerBarRight",components:{groupCreate:O,quitGroup:L["a"]},props:{},data:function(){return{showNotice:!1,showCreate:!1,showQuitGroup:!1,notifications:[],quitGroupId:0}},watch:{},computed:{isInGroupPath:function(){return/\/group\//.test(this.$route.fullPath)},unreadNotify:function(){return this.notifications.filter((function(t){return 1===t.read}))},notificationsShow:function(){return this.notifications.slice(0,6)},user:function(){return this.$store.state.user},isLoggedIn:function(){return""!==this.$store.state.user.userid},currentGroupId:function(){return this.$store.state.group.currentGroup.id},currentGroup:function(){return this.$store.state.group.currentGroup},groupJoined:function(){return this.$store.getters["group/ifCurrentGroupJoined"]},isPinned:function(){var t=this,e=this.$store.state.group.joinedGroupPinnedList.find((function(e){return e.id===t.currentGroupId}));return e?e.pinned:null}},methods:{createGrp:function(){this.showCreate=!0},clearLogin:function(){localStorage.clear(),this.$store.commit("user/resetUserinfo"),this.$q.notify("已退出登录"),location.href="/"},setGroupToTop:function(){var t=this;return u()(c.a.mark((function e(){var n,i,a,o,s;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.currentGroup,i=t.isPinned,!i){e.next=9;break}return a={grp:n.id,pinned:1===i?2:1},o="/protected/grp/pin",e.next=7,Object(d["b"])(o,a);case 7:s=e.sent,0===s.code&&(1===i?t.$q.notify("置顶成功"):t.$q.notify("取消置顶成功"),t.$router.go(0));case 9:case"end":return e.stop()}}),e)})))()},leaveGroup:function(){this.showQuitGroup=!0,this.quitGroupId=this.currentGroupId},getNotifications:function(){var t=arguments,e=this;return u()(c.a.mark((function n(){var i,a,o,r,l,u;return c.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=t.length>0&&void 0!==t[0]?t[0]:0,a="/protected/user/notifications/"+i,n.next=4,e.$axios.get(a);case 4:o=n.sent,0==o.data.code&&o.data.data.notifications.length&&(r=e.$q.localStorage.getItem("notifications")||[],l=o.data.data,u=l.notifications.map((function(t){if(2===t.n_type){var e=l.posts.find((function(e){return e.id===t.post})),n=l.users.find((function(e){return e.id===t.post_user}));t.postIn=e,t.creatorIn=n}else if(3===t.n_type){var i=l.comments.find((function(e){return e.id===t.comment})),a=l.users.find((function(t){return t.id===i.creator}));t.commentIn=i,t.creatorIn=a}return t})),r.unshift.apply(r,s()(u)),e.$q.localStorage.set("notifications",r),e.notifications=r);case 6:case"end":return n.stop()}}),n)})))()},hideNotice:function(){if(!this.showNotice&&this.unreadNotify.length){var t=this.$q.localStorage.getItem("notifications")||[];t.map((function(t){t.read=2})),this.$q.localStorage.set("notifications",t),this.notifications=t}},readNotify:function(){this.showNotice=!this.showNotice}},mounted:function(){if(this.isLoggedIn){var t=this.$q.localStorage.getItem("notifications"),e=0;t&&t.length&&(this.notifications=t,e=t[0].id),this.getNotifications(e)}}},Q=j,E=(n("a4c7"),n("cb32")),N=n("58a8"),B=n("4e73"),D=n("1c1c"),z=n("66e5"),T=n("4074"),A=n("0170"),G=n("eb85"),M=Object(v["a"])(Q,i,a,!1,null,null,null);e["a"]=M.exports;b()(M,"components",{QAvatar:E["a"],QBadge:N["a"],QMenu:B["a"],QList:D["a"],QItem:z["a"],QItemSection:T["a"],QItemLabel:A["a"],QSeparator:G["a"],QDialog:w["a"],QCard:y["a"],QCardSection:_["a"],QSpace:k["a"],QBtn:q["a"]}),b()(M,"directives",{ClosePopup:P["a"]})},"4cb9":function(t,e,n){},"530c":function(t,e,n){},"563d":function(t,e,n){"use strict";var i=n("a5de"),a=n.n(i);a.a},"5ded":function(t,e,n){"use strict";var i=n("c075"),a=n.n(i);a.a},"699f":function(t,e,n){"use strict";var i=n("f8e5"),a=n.n(i);a.a},"6dcb":function(t,e,n){"use strict";n("28a5"),n("7f7f"),n("34ef"),n("551c"),n("06db");var i=n("bc3a"),a=n.n(i),o=n("97af"),s=function(t){var e=t.file;return new Promise((function(t,n){var i=new FileReader;i.onload=function(i){var s,r,c=i.target.result,l=e.type;s=c.length,r=new Uint8Array(s);for(var u=0;u<s;u++)r[u]=c.charCodeAt(u);var d=new Blob([r],{type:l}),p="/protected/oss/presign",h={key:Date.now()+e.name};Object(o["b"])(p,h).then((function(e){if(e){var i=e.presigned_url,o=e.headers;o["Content-Type"]=l;var s=a.a.create({timeout:3e5,headers:o});s({url:i,method:"put",data:d,processData:!1}).then((function(e){200===e.status?(console.log(i.split("?")[0]),t(i.split("?")[0])):n(new Error("上传失败"))})).catch((function(){n(new Error("上传失败"))}))}else n(new Error("认证失败"))})).catch((function(){n(new Error("认证失败"))}))},i.readAsBinaryString(e)}))};e["a"]=s},7720:function(t,e,n){"use strict";var i=n("4cb9"),a=n.n(i);a.a},"97af":function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return r}));n("551c"),n("06db");var i=n("758b"),a=function(t,e,n){return i["a"][t](e,n).then((function(t){return 0===t.data.code?t.data.data:Promise.reject(t.data)}))},o=a.bind(null,"get"),s=a.bind(null,"post"),r=a.bind(null,"put");a.bind(null,"remove")},a4c7:function(t,e,n){"use strict";var i=n("13ac"),a=n.n(i);a.a},a5de:function(t,e,n){},b95e:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"article",staticClass:"container",attrs:{"data-type":t.viewType}},[n("deleteArticle",{attrs:{postId:t.postId},on:{deleteSuccess:function(e){return t.$emit("del",t.postId)}},model:{value:t.showDeleteArticle,callback:function(e){t.showDeleteArticle=e},expression:"showDeleteArticle"}}),t.canEdit?n("EditArticle",{attrs:{postId:t.postId,initialData:t.post.post,onSave:t.afterEdit},model:{value:t.shouldShowEdit,callback:function(e){t.shouldShowEdit=e},expression:"shouldShowEdit"}}):t._e(),t.post.creator?n("div",{staticClass:"header"},[n("router-link",{directives:[{name:"require-login-click",rawName:"v-require-login-click"}],attrs:{to:{name:"person",params:{id:t.post.creator.id+""}}}},[n("q-avatar",{directives:[{name:"show",rawName:"v-show",value:!t.personPage,expression:"!personPage"}],staticClass:"hoverable-avatar",attrs:{size:"35px"}},[n("img",{attrs:{src:t.post.creator.avatar||"statics/user.svg"}})])],1),n("router-link",{directives:[{name:"require-login-click",rawName:"v-require-login-click"}],attrs:{to:{name:"person",params:{id:t.post.creator.id+""}}}},[n("span",{directives:[{name:"show",rawName:"v-show",value:!t.personPage,expression:"!personPage"}],staticClass:"authorName"},[t._v(t._s(t.post.creator.name))])]),n("span",[t._v(t._s(t.$utils.timeStringToLocal(t.post.post.create_at,"RelativeTime")))])],1):t._e(),n("div",{staticClass:"main-body"},["group"===t.viewType?n("router-link",{attrs:{to:{name:"articles",params:{id:t.postId+""}}}},[n("div",{staticClass:"body"},[t._l(t.content_breakLines,(function(e){return n("div",{key:e.id},[t._v(t._s(e||" "))])})),n("div",{directives:[{name:"show",rawName:"v-show",value:t.content_showMore,expression:"content_showMore"}]},[t._v("(点击查看更多...)")])],2)]):n("div",{staticClass:"body"},[t._l(t.content_breakLines,(function(e){return n("div",{key:e.id},[t._v(t._s(e||" "))])})),n("div",{directives:[{name:"show",rawName:"v-show",value:t.content_showMore,expression:"content_showMore"}]},[t._v("(点击查看更多...)")])],2),t.hasVideo?n("div",{staticClass:"video-wraper",class:{"video-wraper-squar":0==t.videoRadioNormal}},[n("q-media-player",{directives:[{name:"intersection",rawName:"v-intersection",value:t.obOptions,expression:"obOptions"}],ref:"videoPlayer",attrs:{"data-id":t.post.post.id,muted:!0,type:"video","background-color":"white",radius:"1rem","hide-volume-slider":"",dense:"","show-big-play-button":!0,source:t.post.post.images[0],preload:"none"},on:{ready:t.readyToPlayVideo,loadeddata:t.testloaded}})],1):n("ImageGrid",{staticClass:"images",attrs:{images:t.post.post.images}}),n("div",{staticClass:"actions"},[t.shouldShowActions?n("q-btn",{directives:[{name:"require-login-click",rawName:"v-require-login-click"}],class:{isLiked:t.isLiked},attrs:{flat:""},on:{click:t.like}},[n("svg",{class:"svg-icon svg-icon--light-grey svg-icon--hover-middle-grey mr10",attrs:{width:"22",height:"23",viewBox:"0 0 22 23",xmlns:"http://www.w3.org/2000/svg","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[n("g",{attrs:{fill:"#E4E4E4","fill-rule":"nonzero"}},[n("path",{attrs:{d:"M20.306 9.02H14.31C16.633.439 12.708 0 12.708 0c-1.664 0-1.319 1.315-1.445 1.535 0 4.197-4.458 7.486-4.458 7.486v11.903c0 1.175 1.601 1.598 2.23 1.598h9.01c.848 0 1.539-2.224 1.539-2.224 2.23-7.58 2.23-9.836 2.23-9.836 0-1.566-1.508-1.441-1.508-1.441zM4.344 9.025H.754c-.743 0-.754.728-.754.728l.742 12.005c0 .764.765.764.765.764h3.108c.648 0 .642-.506.642-.506V9.936c0-.923-.913-.911-.913-.911z"}})])]),n("span",[t._v(t._s(t.post.post.num_like))])]):t._e(),t.shouldShowActions?n("q-btn",{directives:[{name:"require-login-click",rawName:"v-require-login-click"}],attrs:{flat:""},on:{click:t.addComment}},[n("svg",{class:"svg-icon svg-icon--light-grey svg-icon--hover-middle-grey mr10",attrs:{width:"22",height:"20",viewBox:"0 0 22 20",xmlns:"http://www.w3.org/2000/svg","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[n("path",{attrs:{d:"M2.753 0A2.792 2.792 0 000 2.849v11.282c0 1.567 1.272 3.007 2.815 3.007H7c.715.775 3.77 2.754 3.77 2.754a.335.335 0 00.493 0s2.195-1.361 3.626-2.754h4.295c1.56 0 2.816-1.44 2.816-3.007V2.833C22.016 1.266 20.775 0 19.264 0H2.753z",fill:"#E4E4E4","fill-rule":"nonzero"}})]),n("span",[t._v(t._s(t.post.post.num_comment))])]):t._e(),t.shouldShowActions?n("q-btn",{directives:[{name:"require-login-click",rawName:"v-require-login-click"}],attrs:{flat:""},on:{click:function(e){return t.share(t.post.post.id)}}},[n("svg",{class:"svg-icon svg-icon--light-grey svg-icon--hover-middle-grey mr10",attrs:{width:"22",height:"18",viewBox:"0 0 22 18",xmlns:"http://www.w3.org/2000/svg","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[n("path",{attrs:{d:"M.836 17.942a.98.98 0 01-.83-1.083c.477-4.5 2.06-7.823 4.689-9.895 1.89-1.5 4.288-2.334 7.117-2.489l.585-.031v-3.2c0-1.268 1.152-1.546 1.767-.928l7.178 7.344c.908.928.861 1.886-.046 2.814l-6.993 7.159c-.738.742-1.907.294-1.907-.758v-3.432h-.723c-2.628 0-7.408.526-9.914 4.066-.154.294-.461.449-.784.449-.046-.001-.092-.001-.139-.016z",fill:"#E4E4E4","fill-rule":"nonzero"}})])]):t._e(),t.shouldShowSetting?n("q-btn",{attrs:{flat:""}},[n("svg",{class:"svg-icon svg-icon--light-grey svg-icon--hover-middle-grey mr10",attrs:{width:"20",height:"20",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[n("path",{attrs:{d:"M18.547 11.061c-.122-.081-.203-.122-.244-.204a.856.856 0 01-.407-.733V9.31a.91.91 0 01.407-.733.417.417 0 01.244-.204c.652-.366 1.06-1.059 1.019-1.792a9.818 9.818 0 00-1.996-3.3 2.153 2.153 0 00-2.16-.082c-.122.082-.244.082-.326.122-.285.123-.61.123-.855 0l-.774-.407c-.285-.163-.448-.407-.448-.693-.041-.081-.082-.163-.082-.326 0-.774-.448-1.385-1.14-1.71a11.184 11.184 0 00-4.034 0c-.693.325-1.14.977-1.14 1.71 0 .123-.041.245-.082.326 0 .286-.163.57-.448.693l-.774.407c-.286.163-.612.163-.856 0a.65.65 0 01-.326-.122c-.652-.367-1.467-.326-2.118.082C1.11 4.217.458 5.317.01 6.539c-.081.733.326 1.467 1.019 1.833.122.041.204.122.244.204a.856.856 0 01.408.733v.815a.91.91 0 01-.408.733.417.417 0 01-.244.204c-.652.367-1.06 1.06-1.019 1.793a9.819 9.819 0 001.997 3.3c.651.407 1.466.448 2.118.081.122-.081.245-.081.326-.122.285-.122.611-.122.856 0l.774.407c.285.163.448.408.448.693.04.081.081.163.081.326 0 .774.49 1.426 1.141 1.711a10.96 10.96 0 003.993 0c.651-.326 1.14-.978 1.14-1.711 0-.122.041-.245.082-.326 0-.285.163-.57.448-.693l.774-.407c.285-.163.611-.163.856 0a.65.65 0 01.326.122 2.153 2.153 0 002.159-.081c.896-.937 1.548-2.037 1.996-3.26a1.842 1.842 0 00-.978-1.833zm-8.759 1.63c-1.63 0-2.933-1.345-2.933-2.974 0-1.63 1.303-2.974 2.933-2.974s2.933 1.344 2.933 2.974c0 1.63-1.303 2.974-2.933 2.974z",fill:"#E4E4E4","fill-rule":"nonzero"}})]),n("q-menu",{attrs:{"auto-close":""}},[n("q-list",{staticStyle:{"min-width":"100px"}},[t.canPinTop?n("q-item",{attrs:{clickable:""}},[n("q-item-section",{on:{click:function(e){return t.pinTopPost(t.postId)}}},[t._v("置顶")])],1):t._e(),t.canEdit?n("q-item",{attrs:{clickable:""}},[n("q-item-section",{on:{click:t.edit}},[t._v("编辑")])],1):t._e(),n("q-separator"),t.canDelete?n("q-item",{attrs:{clickable:""}},[n("q-item-section",{on:{click:function(e){return t.deletePost(t.postId)}}},[t._v("删除")])],1):t._e()],1)],1)],1):t._e()],1)],1)],1)},a=[],o=n("967e"),s=n.n(o),r=(n("96cf"),n("fa84")),c=n.n(r),l=(n("28a5"),n("c5f6"),n("97af")),u=n("cdde"),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ToastComponent",{attrs:{title:t.title,content:t.content},on:{taost_cancel:t.taost_cancel,taost_confirm:t.taost_confirm},model:{value:t.shouldShow,callback:function(e){t.shouldShow=e},expression:"shouldShow"}})},p=[],h=n("27cf"),f={name:"deleteArticle",components:{ToastComponent:h["a"]},props:{value:Boolean,postId:Number},data:function(){return{title:"确定要删除这个帖子吗？",content:""}},watch:{},computed:{shouldShow:{get:function(){return this.value},set:function(t){this.$emit("input",t)}}},methods:{taost_cancel:function(){this.$q.notify("已取消")},taost_confirm:function(){var t=this;return c()(s.a.mark((function e(){var n,i,a;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n="/protected/post",i={post:t.postId},e.next=4,t.$axios.delete(n,{data:i});case 4:a=e.sent,0==a.data.code?(t.$q.notify("删除成功"),t.$emit("deleteSuccess")):t.$q.notify("删除失败");case 6:case"end":return e.stop()}}),e)})))()}},created:function(){},mounted:function(){}},m=f,v=n("2877"),g=Object(v["a"])(m,d,p,!1,null,null,null),b=g.exports,w=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Publish",t._b({attrs:{placeholder:"有什么新鲜事告诉大家…",publishBtnLabel:"确认修改",doPublish:t.publish,maxTextLength:5e3},model:{value:t.shouldShow,callback:function(e){t.shouldShow=e},expression:"shouldShow"}},"Publish",t.$attrs,!1))},y=[],_=(n("8e6e"),n("8a81"),n("ac6a"),n("cadf"),n("06db"),n("456d"),n("c47a")),k=n.n(_),q=n("c2ac");function x(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function C(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?x(Object(n),!0).forEach((function(e){k()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var $=function(t){var e="/protected/post";return Object(l["c"])(e,C({},t,{title:""}))},S={components:{Publish:q["a"]},props:{postId:{type:Number},onSave:{type:Function},value:Boolean},computed:{shouldShow:{get:function(){return this.value},set:function(t){this.$emit("input",t)}}},methods:{publish:function(t){var e=this;return $(C({},t,{id:this.postId})).then((function(){e.onSave&&e.onSave(C({},t,{id:e.postId}))}))}}},P=S,I=Object(v["a"])(P,w,y,!1,null,null,null),O=I.exports,L=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"viewer",rawName:"v-viewer",value:{inline:!1,button:!0,navbar:!1,title:!1,toolbar:!0,tooltip:!1,movable:!0,zoomable:!0,reset:!1,rotatable:!1,scalable:!1,transition:!0,fullscreen:!0,keyboard:!0},expression:"{\n    inline: false,\n    button: true,\n    navbar: false,\n    title: false,\n    toolbar: true,\n    tooltip: false,\n    movable: true,\n    zoomable: true,\n    reset: false,\n    rotatable: false,\n    scalable: false,\n    transition: true,\n    fullscreen: true,\n    keyboard: true,\n  }"}],staticClass:"grid",attrs:{"data-length":t.images.length}},t._l(t.images,(function(t,e){return n("div",{key:e,staticClass:"grid_item cursor-pointer"},[n("img",{staticClass:"image",attrs:{src:t}})])})),0)},j=[],Q=(n("0808"),n("6944")),E=n.n(Q),N=n("2b0e");N["a"].use(E.a);var B={props:{images:{required:!0,type:Array}},data:function(){return{slide:0,dialog:!1}},methods:{showBigPic:function(t){this.slide=t,this.dialog=!0}}},D=B,z=(n("699f"),n("eebe")),T=n.n(z),A=n("880c"),G=Object(v["a"])(D,L,j,!1,null,"53c0140b",null),M=G.exports;T()(G,"components",{QCarousel:A["a"]});for(var U=[],R=0;R<=1;R+=.2)U.push(R);var V={cancel:1,like:2,dislike:3},F={components:{deleteArticle:b,EditArticle:O,ImageGrid:M},props:{viewType:{type:String,default:"group"},groupCreatorId:Number,post:Object,personPage:{type:Boolean,default:!1},addComment:{type:Function}},data:function(){return{shouldShowEdit:!1,showDeleteArticle:!1,videoRadioNormal:!0,obOptions:{handler:this.onIntersection,cfg:{threshold:U}},lastPercent:0,readyed:!1}},computed:{content_sub:function(){return"group"===this.viewType?this.post.post.content.substr(0,300):this.post.post.content},content_showMore:function(){return this.post.post.content.length>300&&"group"===this.viewType},content_breakLines:function(){return this.content_sub.split("\n")},canEdit:function(){return this.userid===this.post.post.creator},canDelete:function(){return this.userid===this.post.post.creator||this.userid===this.groupCreatorId},canPinTop:function(){return"comment"!==this.viewType&&this.userid===this.groupCreatorId},shouldShowSetting:function(){return this.canEdit||this.canDelete},shouldShowActions:function(){return"comment"!==this.viewType},isLiked:function(){return this.post.likeStatus===V["like"]},postId:function(){return this.post.post.id},userid:function(){return this.$store.state.user.userid},autoPlayWhenDesktop:function(){return this.$q.platform.is.desktop},hasVideo:function(){var t=this.post.post.images,e=[".mp4",".avi",".flv",".mpeg",".wmv",".dat",".asf",".mov",".3gp",".rm",".rmvb",".divx",".dv",".mkv",".qt",".cpk",".fli",".f4v",".m4v",".mod",".swf",".webm"];return!!t.length&&e.some((function(e){return-1!==t[0].toLowerCase().indexOf(e)}))}},methods:{edit:function(){this.shouldShowEdit=!0},afterEdit:function(t){this.$emit("edit",t)},onContentClick:function(){"group"===this.viewType&&this.$router.push("/articles/".concat(this.postId))},like:function(){var t=this;return c()(s.a.mark((function e(){var n,i;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n="/protected/post/like",i={post:t.postId,op:t.isLiked?V["cancel"]:V["like"]},Object(l["b"])(n,i).then((function(){t.post.likeStatus=i.op,i.op===V["like"]?t.post.post.num_like=t.post.post.num_like+1:t.post.post.num_like=t.post.post.num_like-1})).catch((function(e){t.$q.notify(e.message)}));case 3:case"end":return e.stop()}}),e)})))()},share:function(t){var e=this,n="hash"===this.$router.mode?"/#/":"/",i=window.location.protocol+"//"+window.location.host+n+"articles/"+t;Object(u["a"])(i).then((function(){e.$q.notify("帖子地址已复制到剪切板")})).catch((function(){e.$q.notify("浏览器不支持，请手动复制地址")}))},deletePost:function(){var t=this;return c()(s.a.mark((function e(){return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.showDeleteArticle=!0;case 1:case"end":return e.stop()}}),e)})))()},pinTopPost:function(){this.$q.notify("置顶功能尚在开发")},onIntersection:function(t){if(this.autoPlayWhenDesktop){var e=this.$store.state.group.previewVideoDom;if(!0===t.isIntersecting){if(t.intersectionRatio>.7&&t.intersectionRatio>this.lastPercent&&e!=this.$refs.videoPlayer.$media){if(e&&!e.paused&&e.pause)try{e.pause()}catch(n){}this.$store.commit("group/playVideoUnique",this.$refs.videoPlayer.$media),this.$refs.videoPlayer.$media.paused&&this.$refs.videoPlayer.$media.play&&this.readyed&&this.$refs.videoPlayer.$media.play()}this.lastPercent=t.intersectionRatio}else if(!this.$refs.videoPlayer.$media.paused&&this.$refs.videoPlayer.$media.play)try{this.$refs.videoPlayer.pause()}catch(n){}}},readyToPlayVideo:function(){var t=this.$refs.videoPlayer.$media.videoHeight,e=this.$refs.videoPlayer.$media.videoWidth;this.videoRadioNormal=e>1.1*t,this.readyed=!0},testloaded:function(){}},created:function(){},mounted:function(){}},H=F,J=(n("bdb6"),n("cb32")),W=n("6ac0"),K=n("9c40"),X=n("4e73"),Y=n("1c1c"),Z=n("66e5"),tt=n("4074"),et=n("eb85"),nt=n("b498"),it=n("9748"),at=Object(v["a"])(H,i,a,!1,null,"5c9f2c75",null);e["a"]=at.exports;T()(at,"components",{QAvatar:J["a"],QVideo:W["a"],QBtn:K["a"],QMenu:X["a"],QList:Y["a"],QItem:Z["a"],QItemSection:tt["a"],QSeparator:et["a"],QColor:nt["a"]}),T()(at,"directives",{Intersection:it["a"]})},b9e0:function(t,e,n){},bdb6:function(t,e,n){"use strict";var i=n("b9e0"),a=n.n(i);a.a},c075:function(t,e,n){},c2ac:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-dialog",{attrs:{persistent:t.isLoading},model:{value:t.shouldShow,callback:function(e){t.shouldShow=e},expression:"shouldShow"}},[n("div",{staticClass:"container"},[t.isLoading?n("div",{staticClass:"waiting"},[n("q-spinner",{attrs:{color:"primary",size:"3em"}})],1):t._e(),n("div",{staticClass:"header"},[n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"closeIcon header_left",attrs:{icon:"close",flat:"",round:"",dense:""}})],1),t._t("default"),n("div",{ref:"body",staticClass:"body"},[n("img",{staticClass:"avatar",attrs:{src:t.curUserAvatar}}),n("q-input",{staticClass:"textarea",attrs:{borderless:"",autogrow:"",placeholder:t.placeholder,maxlength:t.maxTextLength},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),n("div",{staticClass:"media grid",attrs:{"data-length":t.mediaLength}},[t._l(t.imgList,(function(e){return n("div",{key:e.id,staticClass:"grid_item imgItem",style:{backgroundImage:"url("+e.previewUrl+")"}},[n("div",{staticClass:"close removeBtn",on:{click:function(n){return t.removeMedia("imgList",e.id)}}},[n("q-icon",{attrs:{name:t.removeIcon}})],1)])})),t._l(t.videoList,(function(e){return n("div",{key:e.id,staticClass:"grid_item videoItem"},[n("q-media-player",{attrs:{type:"video","background-color":"black",radius:"4px","hide-volume-slider":"",dense:"","show-big-play-button":!1,sources:[{src:e.previewUrl}]}}),n("div",{staticClass:"close removeBtn",on:{click:function(n){return t.removeMedia("videoList",e.id)}}},[n("q-icon",{attrs:{name:t.removeIcon}})],1)],1)}))],2),n("div",{staticClass:"footer"},[n("div",{staticClass:"footer_left"},[n("svg",{class:"imgBtn svg-icon svg-icon--middle-grey svg-icon--hover-dark-grey",attrs:{width:"24",height:"21",viewBox:"0 0 24 21",xmlns:"http://www.w3.org/2000/svg","svg-inline":"","data-disabled":!t.canUploadImg,role:"presentation",focusable:"false",tabindex:"-1"},on:{click:t.onImgBtnClick}},[n("path",{attrs:{d:"M20.413 20.125H3.163A3.166 3.166 0 010 16.963v-13.8A3.166 3.166 0 013.163 0h17.25a3.166 3.166 0 013.162 3.163v13.8a3.166 3.166 0 01-3.162 3.162zm-17.25-18.4c-.793 0-1.438.645-1.438 1.438v13.8c0 .793.645 1.437 1.438 1.437h17.25c.793 0 1.437-.644 1.437-1.437v-13.8c0-.793-.644-1.438-1.437-1.438H3.163zm7.615 14.825a.86.86 0 01-.61-.253l-2.84-2.84-2.624 2.625a.862.862 0 11-1.22-1.22l3.234-3.234a.888.888 0 011.22 0l3.45 3.45a.862.862 0 01-.61 1.472zm8.655-.953a.86.86 0 01-.61-.253l-4.88-4.88-2.238 2.237a.862.862 0 11-1.22-1.22l2.847-2.847a.862.862 0 011.22 0l5.49 5.49a.862.862 0 01-.61 1.473zM8.855 10.326a3.167 3.167 0 01-3.162-3.163A3.166 3.166 0 018.855 4a3.166 3.166 0 013.163 3.163 3.167 3.167 0 01-3.163 3.163zm0-4.6c-.793 0-1.437.644-1.437 1.437s.645 1.438 1.437 1.438a1.439 1.439 0 000-2.875z",fill:"#8C909D","fill-rule":"nonzero"}})]),n("svg",{class:"imgBtn svg-icon svg-icon--middle-grey svg-icon--hover-dark-grey",attrs:{width:"25",height:"21",viewBox:"0 0 25 21",xmlns:"http://www.w3.org/2000/svg","svg-inline":"","data-disabled":!t.canUploadVideo,role:"presentation",focusable:"false",tabindex:"-1"},on:{click:t.onVideoBtnClick}},[n("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[n("path",{attrs:{d:"M21.162 20.125H3.912a3.166 3.166 0 01-3.163-3.162v-13.8A3.166 3.166 0 013.912 0h17.25a3.166 3.166 0 013.163 3.163v13.8a3.166 3.166 0 01-3.163 3.162zm-17.25-18.4c-.793 0-1.438.645-1.438 1.438v13.8c0 .793.645 1.437 1.438 1.437h17.25c.793 0 1.437-.644 1.437-1.437v-13.8c0-.793-.644-1.438-1.437-1.438H3.912z",fill:"#8C909D","fill-rule":"nonzero"}}),n("path",{attrs:{d:"M13.927 10.154l-2.908-1.696v3.392l2.908-1.696z",stroke:"#8C909D","stroke-width":"3"}})])])]),n("div",{staticClass:"footer_right"},[n("div",{staticClass:"wordLength"},[t._v(t._s(t.content.length)+"/"+t._s(t.maxTextLength))]),n("q-btn",{staticClass:"sendPostBtn",attrs:{unelevated:"",disabled:!t.canPublish,color:"primary"},on:{click:t.publish}},[n("svg",{class:"svg-icon svg-icon--white",attrs:{width:"14",height:"14",viewBox:"0 0 14 14",xmlns:"http://www.w3.org/2000/svg","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[n("path",{attrs:{d:"M0 7.612l4.348 1.863 7.011-6.233-5.133 6.265 5.655 1.845L14 0 0 7.612zM6.226 14l2.459-2.349-2.459-.813V14z",fill:"#FFF","fill-rule":"nonzero"}})]),n("span",[t._v(t._s(t.publishBtnLabel))])])],1)]),n("input",{ref:"imgInput",attrs:{hidden:"hidden",id:"file-chooser",type:"file",accept:"image/*",multiple:""},on:{change:t.uploadImg}}),n("input",{ref:"videoInput",attrs:{hidden:"hidden",id:"vadio-chooser",type:"file",accept:"video/*"},on:{change:t.uploadVideo}})],2)])},a=[],o=(n("8e6e"),n("8a81"),n("456d"),n("967e")),s=n.n(o),r=(n("551c"),n("ac6a"),n("cadf"),n("06db"),n("5df3"),n("96cf"),n("fa84")),c=n.n(r),l=(n("4917"),n("c47a")),u=n.n(l),d=n("118e"),p=n.n(d),h=n("4db1"),f=n.n(h),m=(n("f751"),n("c5f6"),n("6dcb")),v=n("06ae"),g=function(){var t=c()(s.a.mark((function t(e){return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e;case 3:return t.abrupt("return",t.sent);case 6:return t.prev=6,t.t0=t["catch"](0),t.abrupt("return",t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e){return t.apply(this,arguments)}}(),b=g,w=n("d272");function y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function _(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(Object(n),!0).forEach((function(e){u()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var k={created:function(){this.removeIcon=v["a"],this.sendIcon=w["a"]},props:{maxTextLength:{type:Number,default:2e3},placeholder:{type:String},publishBtnLabel:{type:String},initialData:{type:Object,default:function(){return{content:"",images:[]}}},doPublish:{type:Function,required:!0},onEdit:{type:Function},shouldResetAfterClose:{type:Boolean,default:!0},value:Boolean},data:function(){return this.getDefaultData()},watch:{shouldShow:function(t){!t&&this.shouldResetAfterClose&&Object.assign(this,this.getDefaultData())},content:function(){this.onChange()},videoList:function(){this.onChange()},imgList:function(){this.onChange()}},computed:{shouldShow:{get:function(){return this.value},set:function(t){this.$emit("input",t)}},canPublish:function(){var t=this.content.trim().length;return(t>0||0===t&&this.mediaLength>0)&&t<=this.maxTextLength},curUserAvatar:function(){return this.$store.state.user.avatar||"statics/user.svg"},mediaLength:function(){return this.videoList.length>0?this.videoList.length:this.imgList.length},canUploadImg:function(){return 0===this.videoList.length&&4!==this.imgList.length},canUploadVideo:function(){return 0===this.videoList.length&&0===this.imgList.length}},methods:{onChange:function(){if(this.onEdit){var t={images:[].concat(f()(this.imgList),f()(this.videoList)),content:this.content};this.onEdit(t)}},getDefaultData:function(){var t=this.initialData,e=t.images,n=p()(t,["images"]),i=_({isLoading:!1,videoList:[],imgList:[],content:""},n);if(!e||0===e.length)return i;var a=e.map((function(t){return{file:null,previewUrl:t,id:t}}));return e[0].match(/\.(png|jpe?g|gif)/i)?_({},i,{imgList:a}):_({},i,{videoList:a})},removeMedia:function(t,e){this[t]=this[t].filter((function(t){return t.id!==e}))},warnTooManyFiles:function(){return this.$q.notify("只能上传四张图片，或一个视频")},onImgBtnClick:function(){if(4===this.imgList.length||1===this.videoList.length)return this.warnTooManyFiles();this.$refs.imgInput.click()},onVideoBtnClick:function(){if(this.imgList.length>0||1===this.videoList.length)return this.warnTooManyFiles();this.$refs.videoInput.click()},uploadImg:function(t){var e=t.target.files;if(0!==e.length){if(this.imgList.length+e.length>4)return this.warnTooManyFiles();var n=[].map.call(e,(function(t,e){return{file:t,id:Date.now()+e,previewUrl:window.URL.createObjectURL(t)}}));this.imgList=this.imgList.concat(n),t.target.value=""}},uploadVideo:function(t){var e=t.target.files[0];if(e){if(e.size/1e6>1e3)return t.target.value="",this.$q.notify("文件大小不能超过 1000M");this.videoList.push({file:e,id:Date.now(),previewUrl:window.URL.createObjectURL(e)}),t.target.value=""}},publish:function(){var t=c()(s.a.mark((function t(){var e,n,i=this;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!==this.content.trim().length||0!=this.mediaLength.length){t.next=2;break}return t.abrupt("return",this.$q.notify("请输入内容"));case 2:return this.isLoading=!0,t.next=5,b(Promise.all([].concat(f()(this.imgList),f()(this.videoList)).map((function(t){var e=t.file,n=t.previewUrl;return null===e?Promise.resolve(n):Object(m["a"])({file:e,dispositionType:"attachment"})}))));case 5:if(e=t.sent,!(e instanceof Error)){t.next=10;break}return this.isLoading=!1,this.$q.notify("发布失败,"+e),t.abrupt("return");case 10:n={content:this.content,images:e},this.doPublish(n).then((function(){Object.assign(i,i.getDefaultData(),{shouldShow:!1}),i.$q.notify("发布成功")})).catch((function(t){i.isLoading=!1;var e="string"===typeof t?t:t.message;i.$q.notify("发布失败,"+e)}));case 12:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}},q=k,x=(n("c7c8"),n("2877")),C=n("eebe"),$=n.n(C),S=n("24e8"),P=n("0d59"),I=n("9c40"),O=n("27f9"),L=n("0016"),j=n("7f67"),Q=Object(x["a"])(q,i,a,!1,null,"133e0b48",null);e["a"]=Q.exports;$()(Q,"components",{QDialog:S["a"],QSpinner:P["a"],QBtn:I["a"],QInput:O["a"],QIcon:L["a"]}),$()(Q,"directives",{ClosePopup:j["a"]})},c7c8:function(t,e,n){"use strict";var i=n("530c"),a=n.n(i);a.a},c7eb:function(t,e,n){},d443:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("input",{ref:"imgInput",attrs:{hidden:"hidden",type:"file",accept:"image/*"},on:{change:t.uploadImg}})},a=[],o=(n("7f7f"),n("967e")),s=n.n(o),r=(n("96cf"),n("fa84")),c=n.n(r),l=n("6dcb"),u={components:{},props:{},data:function(){return{}},watch:{},computed:{},methods:{upload:function(){this.$refs.imgInput.click()},uploadImg:function(t){var e=this;return c()(s.a.mark((function n(){var i,a;return s.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=t.target.files[0],i){n.next=3;break}return n.abrupt("return");case 3:if(!(i.size/1e6>5)){n.next=6;break}return t.target.value="",n.abrupt("return",e.$q.notify("头像大小不能超过 5M"));case 6:return e.$emit("uploading"),n.next=9,Object(l["a"])({file:i});case 9:a=n.sent,a instanceof Error?(e.$q.notify("头像上传失败，"+a),e.$emit("uploaded",{err:a})):e.$emit("uploaded",{url:a}),t.target.value="";case 12:case"end":return n.stop()}}),n)})))()},updateUserAvatar:function(t){var e=this;return c()(s.a.mark((function n(){var i,a,o;return s.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i="/protected/user/modify",a={name:e.$store.state.user.name,avatar:t},n.next=4,e.$axios.put(i,a);case 4:o=n.sent,0===o.data.code?e.$q.notify("头像修改成功"):e.$q.notify("头像修改失败");case 6:case"end":return n.stop()}}),n)})))()}},created:function(){},mounted:function(){}},d=u,p=n("2877"),h=Object(p["a"])(d,i,a,!1,null,null,null);e["a"]=h.exports},de22:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"main"},[n("router-link",{attrs:{to:{path:"/"}}},[n("q-btn",{staticClass:"mainpage-btn",attrs:{flat:"",dense:""}},[t._v("DAO")])],1)],1)},a=[],o={name:"headerBarLeft",props:{},data:function(){return{showCreate:!1}},watch:{},computed:{},methods:{createGrp:function(){this.showCreate=!0},clearLogin:function(){localStorage.removeItem("token"),localStorage.removeItem("userinfo"),localStorage.removeItem("notifications"),this.$router.go(0)}},created:function(){},mounted:function(){}},s=o,r=(n("e73d"),n("2877")),c=n("eebe"),l=n.n(c),u=n("4e73"),d=n("1c1c"),p=n("66e5"),h=n("4074"),f=n("eb85"),m=n("9c40"),v=Object(r["a"])(s,i,a,!1,null,"5ba94014",null);e["a"]=v.exports;l()(v,"components",{QMenu:u["a"],QList:d["a"],QItem:p["a"],QItemSection:h["a"],QSeparator:f["a"],QBtn:m["a"]})},e019:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Publish",t._b({attrs:{publishBtnLabel:"发布",placeholder:"发布你的回复",doPublish:t.publish},model:{value:t.shouldShow,callback:function(e){t.shouldShow=e},expression:"shouldShow"}},"Publish",t.$attrs,!1),[n("div",{staticClass:"container"},[n("img",{staticClass:"avatar",attrs:{src:t.targetPost.creator.avatar||"statics/user.svg"}}),n("div",{staticClass:"right"},[n("div",{staticClass:"meta"},[n("span",{staticClass:"name"},[t._v(t._s(t.targetPost.creator.name))]),n("span",{staticClass:"time"},[t._v(t._s(t.$utils.timeStringToLocal(t.targetPost.post.create_at,"RelativeTime")))])]),n("div",{staticClass:"content"},[t._v(t._s(t.targetPost.post.content.substr(0,300)))])])])])},a=[],o=(n("8e6e"),n("8a81"),n("ac6a"),n("cadf"),n("06db"),n("456d"),n("c47a")),s=n.n(o),r=n("c2ac"),c=n("97af");function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){s()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d=function(t){return Object(c["b"])("/protected/comment/create",u({},t,{ref_comment:null})).then((function(t){return t.comment}))},p={components:{Publish:r["a"]},props:{targetPost:{type:Object,required:!0},onSave:{type:Function},value:Boolean},computed:{shouldShow:{get:function(){return this.value},set:function(t){this.$emit("input",t)}}},methods:{publish:function(t){var e=this;return d(u({},t,{post:this.targetPost.post.id})).then((function(t){e.onSave&&e.onSave(t)}))}}},h=p,f=(n("5ded"),n("2877")),m=Object(f["a"])(h,i,a,!1,null,"7d309f4d",null);e["a"]=m.exports},e73d:function(t,e,n){"use strict";var i=n("c7eb"),a=n.n(i);a.a},eeee:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"fit row"},t._l(t.members,(function(e){return n("div",{key:e.id,staticClass:"main"},[n("div",[t.edit?n("q-avatar",{attrs:{size:t.size}},[n("img",{attrs:{src:e.avatar||"statics/user.svg"}}),n("q-badge",{staticClass:"cursor-pointer",attrs:{color:"red",floating:""},on:{click:function(n){return n.stopPropagation(),t.setMember(e.id)}}},[t._v("x")])],1):n("router-link",{directives:[{name:"require-login-click",rawName:"v-require-login-click"}],attrs:{to:{name:"person",params:{id:e.id+""}}}},[n("q-avatar",{staticClass:"hoverable-avatar",attrs:{size:t.size}},[e.avatar?n("img",{attrs:{src:e.avatar||"statics/user.svg"}}):n("div",{style:{width:t.size,height:t.size,margin:"0 auto"}},[n("avataaars",{staticClass:"img",staticStyle:{"margin-top":"-5px"}})],1)])],1)],1),n("router-link",{directives:[{name:"require-login-click",rawName:"v-require-login-click"}],attrs:{to:{name:"person",params:{id:e.id+""}}}},[n("div",{staticClass:"cursor-pointer name"},[t._v(t._s(e.name.substr(0,20)))])])],1)})),0)},a=[],o=n("967e"),s=n.n(o),r=(n("96cf"),n("fa84")),c=n.n(r),l=n("c5fd"),u=n.n(l),d={components:{Avataaars:u.a},props:{members:Array,edit:{type:Boolean,default:!1},blocked:{type:Boolean,default:!1},mainpage:{type:Boolean,default:!1},size:{type:String,default:"55px"}},data:function(){return{showBlock:!1,clickedMemberId:0}},methods:{jumpToMember:function(t){this.$router.push("/person/show/"+t)},setMember:function(t){this.showBlock=!0,this.blockMember(t)},blockMember:function(t){var e=this;return c()(s.a.mark((function n(){var i,a,o;return s.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i="/protected/grp/block",a={grp:e.$store.state.group.currentGroup.id,user:t,block:e.blocked?1:2},n.next=4,e.$axios.post(i,a);case 4:o=n.sent,0===o.data.code?(e.$q.notify({message:e.blocked?"已解除拉黑":"已拉黑该用户"}),e.$emit("changeBlockStatus",{userId:t,type:e.blocked?"unblock":"block"})):104===o.data.code&&(e.$q.notify({message:"认证失效，请重新登录"}),e.$showLogin());case 6:case"end":return n.stop()}}),n)})))()}}},p=d,h=(n("563d"),n("2877")),f=n("eebe"),m=n.n(f),v=n("cb32"),g=n("58a8"),b=Object(h["a"])(p,i,a,!1,null,"552ecf3b",null);e["a"]=b.exports;m()(b,"components",{QAvatar:v["a"],QBadge:g["a"]})},f8c8:function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return s}));n("551c"),n("06db");var i=n("758b"),a=function(t){return function(e,n){return new Promise((function(a,o){i["a"][t](e,n).then((function(t){0===t.data.code?a(t.data):o(t.data.message)})).catch((function(t){o(t)}))}))}},o=a("get"),s=a("post");a("put"),a("delete")},f8e5:function(t,e,n){}}]);